FROM public.ecr.aws/lambda/python:3.12

RUN dnf distro-sync
RUN dnf install -y libpq-devel gcc

COPY requirements.txt .

RUN pip install --upgrade pip
RUN pip install -r requirements.txt --target .

ARG AWS_ACCESS_KEY_ID
ARG AWS_SECRET_ACCESS_KEY
ARG AWS_DEFAULT_REGION
ARG DB_HOST 
ARG DB_USERNAME 
ARG DB_PASSWORD 
ARG DB_NAME 
ARG CONNECT_2_URL

ENV DB_HOST $DB_HOST
ENV DB_USERNAME $DB_USERNAME
ENV DB_PASSWORD $DB_PASSWORD
ENV DB_NAME $DB_NAME
ENV CONNECT_2_URL $CONNECT_2_URL
ENV AWS_ACCESS_KEY_ID $AWS_ACCESS_KEY_ID
ENV AWS_SECRET_ACCESS_KEY $AWS_SECRET_ACCESS_KEY
ENV AWS_DEFAULT_REGION $AWS_DEFAULT_REGION

COPY app.py .

COPY model.py .

COPY util.py .

CMD [ "app.handler" ]